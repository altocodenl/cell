- "TEXT TO PATHS" 1 ct ""
                    r ""
                    tag "Empty text"

                  2 ct " "
                    r error "The first line of the message cannot be indented"
                    tag "Indent out of place"

                  3 ct "
                         "
                    r error "The first line of the message cannot be indented"
                    tag "Indent out of place on the second line"

                  4 ct "holding/"out"
                    r error "The line `holding/"out` has an unescaped quote."
                    tag "Unescaped literal quote"
                    ignore 5 cl 1 "/"multiline"
                                2 " trickery/" some 2 /"calm"
                                3 "                   animal/""
                             r ok
                             tag "validator 5"

- "PUT VALIDATION" 1 c @ put foo bar 1
                                 jip 2
                     r error "A put call has to be a hash with a value (`v`) and an optional path (`p`)."
                     tag "Invalid put with direct values"

                   2 c @ put 1 foo
                             2 bar
                     r error "A put call has to be a hash with a value (`v`) and an optional path (`p`)."
                     tag "Invalid put with numeric keys"

                   3 c @ put k foo
                             v bar
                     r error "A put call has to be a hash with a value (`v`) and an optional path (`p`)."
                     tag "Invalid put with wrong key names"

                   4 c @ put p foo
                             v bar
                             x jip
                     r error "A put call has to be a hash with a value (`v`) and an optional path (`p`)."
                     tag "Invalid put with extra key x"

                   5 c @ put p foo
                             v bar
                             x jip
                     r error "A put call has to be a hash with a value (`v`) and an optional path (`p`)."
                     tag "Invalid put with extra key x (duplicate)"

- "GET & PUT" 1 c @
                r ""
                tag "Get everything when the dataspace is empty"
                comments leftmostAt 0
                         rightmostAt 0
                         contextPath <empty>
                         targetPath <empty>
                         valuePath <empty>
                         prefix ??

              2 c @ x
                r ""
                tag "Get one prefix when the dataspace is empty"

              3 c @ put p party
                        v list 1 Jan
                               2 Jip
                          open 1
                r ok
                tag "Create a hash with three paths"

              4 c @ put p serious
                        v business
                r ok
                tag "Create another hash"

              5 c @
                r party list 1 Jan
                             2 Jip
                        open 1
                  serious business
                tag "Get everything and obtain both hashes"

              6 c @ party
                r list 1 Jan
                       2 Jip
                  open 1
                tag "Get one prefix to get the entire party"

              7 c @ party list
                r 1 Jan
                  2 Jip
                tag "Get a longer prefix to get just the list"

              8 c @ party list 1
                r Jan
                tag "Get the first guest only"

              9 c @ party list 1 Jan
                r ""
                tag "Get the entire first path and obtain nothing"

              10 c @ no such thing
                 r ""
                 tag "Get no such thing"

              11 c @ party open
                 r 1
                 tag "Get the status of the party"

              12 c @ serious
                 r business
                 tag "Get just the business"

              13 c @ serious business
                 r ""
                 tag "Get the entire last path and obtain nothing"

              14 c @ put p party
                         v 1
                 tag "Overwrite prefix with multiple paths"

              15 c @
                 r party 1
                   serious business
                 tag "Get everything after overwriting prefix with multiple paths"

              16 c @ put p party
                         v list 1 Jan
                                2 Jip
                           open 1
                 tag "Restore party"

- WIPE 1 c @ wipe serious
         r ok
         tag "Wipe serious"

       2 c @
         r party list 1 Jan
                      2 Jip
                 open 1
         tag "Get everything after serious was wiped"

       3 c @ wipe party list 1 Jan Hertog
         r ok
         tag "Wipe a path that does not exist, should change nothing"

       4 c @
         r party list 1 Jan
                      2 Jip
                 open 1
         tag "Get everything after wipe no-op"

       5 c @ wipe party list 1
         tag "Wipe the first member of the list"

       6 c @ party
         r list 1 Jip
           open 1
         tag "Get party after one element was wiped"

       7 c @ wipe
         tag "Wipe everything"

       8 c @
         r ""
         tag "Get everything after wipe and obtain nothing"

       9 c @ put p nested
                 v 1 list 1 Jan
                          2 Jip
                   2 open
         tag "Setting a nested list"

       10 c @ wipe nested 1 list 1
          tag "Wiping part of a nested list"

       11 c @
          r nested 1 list 1 Jip
                   2 open
          tag "Get everything after wiping part of a nested list"

       12 c @ wipe
          tag "Wipe everything"

- "GET WITH CONTEXT" 1 c @ put v employee price 15
                                 friend price 20
                                 price 30
                       tag "Initialize the three prices"

                     2 c @
                       r employee price 15
                         friend price 20
                         price 30
                       tag "Verify that the three prices are initialized"

                     3 c @ price
                       r 30
                       tag "Get outermost price"

                     4 c @ put p employee gets
                               v @ price
                       tag "Set reference to employee price"

                     5 c @ employee gets
                       r = 15
                         @ price
                       tag "Get employee price"

                     6 c @ put p friend gets
                               v @ price
                       tag "Set reference to friend price"

                     7 c @ friend gets
                       r = 20
                         @ price
                       tag "Get friend price"

                     8 c @ put p outside gets
                               v @ price
                       tag "Set reference to outside price"

                     9 c @ outside gets
                       r = 30
                         @ price
                       tag "Get outside price"

                     10 c @ wipe

- "GET WITH DOT" 1 c @ put v employee @ . price
                                      price 15
                             @ . price
                             price 30
                             z @ . price
                   tag "Set two prices and three dot references"

                 2 c @
                   r employee price 15
                              = 15
                              @ . price
                     price 30
                     z = ""
                       @ . price
                     = 30
                     @ . price

                   tag "Get all dot references"

- PUT

- "PUT WITH CONTEXT PATH"

- "PUT WITH DOT"

- RESPOND - c @ wipe

          - c @ put v foo 10
                      reffoo @ foo
            r ok
            tag "Set a reference to foo"

          - c @
            r foo 10
              reffoo = 10
                     @ foo
            tag "Get the reference to foo"

          - c @ put p foo
                    v 20
            tag "Update foo"

          - c @
            r foo 20
              reffoo = 20
                     @ foo
            tag "Check that the reference to foo has an updated value"

          - c @ put p reffoo =
                    v 30
            tag "Overwrite the = key of the reference"

          - c @
            r foo 20
              reffoo = 20
                     @ foo
            tag "Check that overwriting the result made no difference"

          - c @ put p a
                    v @ nonesuch

          - c @ a
            r = ""
              @ nonesuch
            tag "Check that a reference to nothing yields an empty text but the reference is still there"

          - c @ wipe

          - c @ put v counter 1
                      indirect @ users @ counter
                      users 1 jip

          - c @
            r counter 1
              indirect = jip
                       @ users = 1
                               @ counter
              users 1 jip
            tag "Use a reference to reference a certain element of a list (two references side by side)"

          - c @ wipe
          - c @ put v aqualung great
                      indirect @ score @ aqualung
                      score great 100

          - c @
            r aqualung great
              indirect = 100
                       @ score = great
                               @ aqualung
              score great 100
            tag "Use a reference to reference a certain element of a hash (two references side by side)"

          - c @ wipe
          - c @ put v closet sock
                      house @ room
                      room @ closet

          - c @
            r closet sock
              house = = sock
                      @ closet
                    @ room
              room = sock
                   @ closet
            tag "Make a reference to a reference in order ba//dc//cb"

          - c @ wipe
          - c @ put v foo bar
                      joo @ jip

          - c @
            r foo bar
              joo = ""
                  @ jip
            tag "Make a reference to a reference in order ba//cb//dc, step one"

          - c @ put v jip @ foo

          - c @
            r foo bar
              jip = bar
                  @ foo
              joo = = bar
                    @ foo
                  @ jip
            tag "Make a reference to a reference in order ba//cb//dc, step two"
